<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DeepSeek AI Nutrition</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #000000;
            --card-bg: rgba(30, 30, 30, 0.7);
            --border-color: rgba(255, 255, 255, 0.15);
            --text-color: #f0f0f0;
            --text-muted: #8e8e93;
            --accent-blue: #0A84FF;
            --accent-pink: #FF2D55;
            --accent-yellow: #FFCC00;
        }

        body {
            margin: 0; padding: 16px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color); color: var(--text-color);
            min-height: 100vh; display: flex; flex-direction: column; gap: 16px;
            position: relative; overflow-x: hidden;
        }

        /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω */
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: radial-gradient(circle at 10% 20%, #0A84FF 0%, transparent 30%),
                        radial-gradient(circle at 90% 80%, #FF2D55 0%, transparent 30%);
            animation: background-pan 20s linear infinite;
        }
        @keyframes background-pan {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* –°—Ç–µ–∫–ª—è–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(25px) saturate(180%);
            border: 1px solid var(--border-color);
            border-radius: 24px;
            padding: 20px;
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .top-bar { display: flex; justify-content: space-between; align-items: center; }
        .btn-icon { background: rgba(255,255,255,0.1); border: none; color: #fff; padding: 8px 12px; border-radius: 12px; cursor: pointer; font-size: 18px; }
        select.lang-select {
            -webkit-appearance: none; appearance: none;
            background: transparent; color: var(--text-muted); border: none; outline: none; text-align: right;
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .main-stats { text-align: center; margin-bottom: 15px; }
        .cals-big { font-size: 36px; font-weight: 700; letter-spacing: -1px; }
        .cals-sub { font-size: 14px; color: var(--text-muted); }
        .macros-grid { display: flex; gap: 10px; margin-top: 10px; }
        .macro-item { flex: 1; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 14px; font-size: 12px; text-align: center; }
        .macro-val { font-weight: 600; font-size: 14px; display: block; }
        .macro-bar-bg { width: 100%; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; margin-top: 5px; }
        .macro-bar-fill { height: 100%; border-radius: 2px; width: 0%; transition: width 0.5s; }
        .p-color { color: var(--accent-blue); } .p-bg { background: var(--accent-blue); }
        .f-color { color: var(--accent-pink); } .f-bg { background: var(--accent-pink); }
        .c-color { color: var(--accent-yellow); } .c-bg { background: var(--accent-yellow); }

        /* –í–≤–æ–¥ */
        textarea { width: 100%; background: transparent; border: none; color: var(--text-color); padding: 15px 0; font-size: 18px; resize: none; outline: none; box-sizing: border-box; }
        textarea::placeholder { color: var(--text-muted); }
        .btn-send { width: 100%; margin-top: 15px; background: var(--accent-blue); color: white; border: none; border-radius: 16px; height: 55px; font-weight: 600; font-size: 18px; cursor: pointer; }
        .btn-send:disabled { background: #555; }
        
        /* –ò—Å—Ç–æ—Ä–∏—è */
        .food-list { list-style: none; padding: 0; margin: 0; }
        .food-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border-color); }
        .food-item:first-child { padding-top: 0; } .food-item:last-child { border-bottom: none; }
        .food-desc { font-size: 12px; color: var(--text-muted); margin-top: 2px; }

        /* –ú–æ–¥–∞–ª–∫–∞ */
        #profileModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 100; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .modal-content { background: #1c1c1e; padding: 20px; border-radius: 28px; width: 85%; border: 1px solid var(--border-color); }
        .form-group { margin-bottom: 10px; }
        .form-group label { display: block; font-size: 13px; margin-bottom: 5px; color: var(--text-muted); }
        .form-control { width: 100%; padding: 10px; background: #2c2c2e; border: 1px solid #3a3a3c; color: white; border-radius: 10px; box-sizing: border-box; }
        .btn-save { width: 100%; background: var(--accent-blue); color: white; padding: 12px; border: none; border-radius: 12px; font-weight: 600; margin-top: 10px; font-size: 16px; }
    </style>
</head>
<body>
    <div class="top-bar">
        <button class="btn-icon" onclick="openProfile()">‚öôÔ∏è</button>
        <select id="langSelect" class="lang-select" onchange="changeLanguage()">
            <option value="ru">RU</option> <option value="uz">UZ</option> <option value="en">EN</option>
        </select>
    </div>
    <div class="glass-card">
        <div class="main-stats">
            <div class="cals-big"><span id="currCals">0</span> / <span id="targetCals">2000</span></div>
            <div class="cals-sub" id="txtKcal">–∫–∫–∞–ª —Å–µ–≥–æ–¥–Ω—è</div>
        </div>
        <div class="macros-grid">
            <!-- –ë–ñ–£ –ë–ª–æ–∫–∏ -->
        </div>
    </div>
    <div class="glass-card">
        <textarea id="foodInput" rows="2" placeholder="–°—ä–µ–ª 2 —è–π—Ü–∞ –∏ —Ç–æ—Å—Ç..."></textarea>
        <button class="btn-send" id="analyzeBtn" onclick="processFood()">–ê–Ω–∞–ª–∏–∑</button>
    </div>
    <div class="glass-card">
        <div style="font-weight:600; color:var(--text-muted); margin-bottom:10px;" id="txtHistory">–ò—Å—Ç–æ—Ä–∏—è</div>
        <ul class="food-list" id="foodList"></ul>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ (HTML —Ç–æ—Ç –∂–µ) -->
    <div id="profileModal"><!-- ... --></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.setHeaderColor('#000000'); 
        tg.setBackgroundColor('#000000');

        // üëáüëáüëá –¢–í–û–Ø –°–°–´–õ–ö–ê NGROK üëáüëáüëá
        const BASE_URL = "https://deja-embryoid-rosendo.ngrok-free.dev"; 

        const USER_ID = tg.initDataUnsafe?.user?.id || 1; 
        
        let stats = { cals: 0, p: 0, f: 0, c: 0 };
        let targets = { cals: 2000, p: 150, f: 70, c: 200 };

        async function processFood() {
            const textInput = document.getElementById('foodInput').value.trim();
            const btn = document.getElementById('analyzeBtn');

            if(!textInput) return;
            btn.disabled = true; btn.innerText = "...";

            const body = {
                text: textInput,
                user_id: USER_ID,
                language: 'ru' // –ó–∞–º–µ–Ω–∏ –Ω–∞ currentLang, –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å
            };

            try {
                const res = await fetch(`${BASE_URL}/analyze`, {
                    method: 'POST',
                    headers: {
                        "ngrok-skip-browser-warning": "true",
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(body)
                });
                
                const data = await res.json();
                
                if(data.calories > 0) {
                    loadHistory();
                    document.getElementById('foodInput').value = '';
                    tg.HapticFeedback.notificationOccurred('success');
                } else {
                    tg.showPopup({message: '–ù–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ'});
                }
            } catch(e) { alert("Error"); }
            finally { btn.disabled = false; btn.innerText = "–ê–Ω–∞–ª–∏–∑"; }
        }

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ JS —Ñ—É–Ω–∫—Ü–∏–∏ (loadHistory, saveProfile –∏ —Ç.–¥.) –æ—Å—Ç–∞–ª–∏—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        // ...
    </script>
</body>
</html>
